


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CEP 18 - Dynamic Resource Exchange Procedure &mdash; Cyclus Home</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Cyclus Home" href="../index.html" />
    <link rel="up" title="Cyclus Enhancement Proposals" href="cep0.html" />
    <link rel="prev" title="CEP 17 - Resource Tracking and Interfaces Re-Re-Redo" href="cep17.html" />
   
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12222727-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
  <a href="http://cyclus.github.com">
    <img src="../_static/logo1.png"/>
  </a>
</div>


    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="cep17.html" title="CEP 17 - Resource Tracking and Interfaces Re-Re-Redo"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Cyclus Home</a> &raquo;</li>
          <li><a href="cep0.html" accesskey="U">Cyclus Enhancement Proposals</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CEP 18 - Dynamic Resource Exchange Procedure</a><ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a><ul>
<li><a class="reference internal" href="#supply-demand-framework">Supply-Demand Framework</a><ul>
<li><a class="reference internal" href="#facility-agency">Facility Agency</a></li>
<li><a class="reference internal" href="#institutional-agency">Institutional Agency</a></li>
<li><a class="reference internal" href="#regional-agency">Regional Agency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#market-resolution">Market Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification-implementation">Specification &amp; Implementation</a><ul>
<li><a class="reference internal" href="#constituent-classes-and-containers">Constituent Classes and Containers</a></li>
<li><a class="reference internal" href="#resource-exchange">Resource Exchange</a><ul>
<li><a class="reference internal" href="#rfb-phase">RFB Phase</a></li>
<li><a class="reference internal" href="#rrfb-phase">RRFB Phase</a></li>
<li><a class="reference internal" href="#pa-procedure">PA Procedure</a></li>
<li><a class="reference internal" href="#marketalgorithm">MarketAlgorithm</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#document-history">Document History</a></li>
<li><a class="reference internal" href="#references-and-footnotes">References and Footnotes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cep17.html"
                        title="previous chapter">CEP 17 - Resource Tracking and Interfaces Re-Re-Redo</a></p>
  <h3>Useful Pages</h3>
    <li><a href="http://cyclus.github.com/basics/glossary.html">Glossary</a></li>
    <li><a href="http://cyclus.github.com/basics/roadmap.html">Roadmap</a></li>
    <li><a href="https://github.com/cyclus">Source Code</a></li>
    <li><a href="http://cnergdata.engr.wisc.edu/cyclus/core/docs/">Cyclus Core Documentation</a></li>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3>Acknowledgements</h3>
    Support for this research has included funding received from:
    <img src=/_images/neup_logo_large.jpg width=170px>
    <img src=/_images/AnlLogo.png height=100px>
    <img src=/_images/USNRC.gif height=100px>
    <img src=/_images/nsf_logo.jpg height=100px>
    <img src=/_images/crest.png height=100px>

    

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="cep-18-dynamic-resource-exchange-procedure">
<h1>CEP 18 - Dynamic Resource Exchange Procedure<a class="headerlink" href="#cep-18-dynamic-resource-exchange-procedure" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">CEP:</th><td class="field-body">18</td>
</tr>
<tr class="field-even field"><th class="field-name">Title:</th><td class="field-body">Dynamic Resource Exchange Procedure</td>
</tr>
<tr class="field-odd field"><th class="field-name">Last-Modified:</th><td class="field-body">2013-10-31</td>
</tr>
<tr class="field-even field"><th class="field-name">Author:</th><td class="field-body">Matthew Gidden</td>
</tr>
<tr class="field-odd field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field-even field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field-odd field"><th class="field-name">Created:</th><td class="field-body">2013-09-02</td>
</tr>
</tbody>
</table>
<div class="section" id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>An updated procedure for determining dynamic resource exchanges is presented. It
occurs nominally in four phases: a request for bids, a response to the request
for bids, preference assignment, and resolution. The first three phases
encompass an information gathering procedure, providing generic information to
any market exchange solution procedure. The final phase is modular in that any
algorithm can be used to solve the exchange. This modular phase takes the place
of the current implementation of MarketModels. The procedure is informed by
agent-based supply chain modeling literature <a class="reference internal" href="#julka-agent-based-2002">[1]</a> with
modifications as required for our nuclear-engineering domain specific
information.</p>
</div>
<div class="section" id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>The current implementation of Markets in Cyclus includes a base MarketModel
class which is intended to be derived from by concrete, dynamically loaded,
user-defined classes. Markets are assigned specific commodities, i.e., there is
no communication across demand for multiple commodities. Markets act in the
simulation during the <strong>resolve</strong> step, which occurs after the <strong>tick</strong> and
before the <strong>tock</strong> for each timestep.</p>
<p>Markets are communicated with through Messages. Communication to Markets utilize
the Transaction class to define whether the communication is an <strong>offer</strong> or
<strong>request</strong> for the Market&#8217;s commodity. Communication is initialized by
Facilities, but there is no Cyclus core support for this operation. Individual
derived Facilities (e.g., the SinkFacility and SourceFacility in Cycamore)
define this functionality during their <strong>HandleTick</strong> functions. This
interaction is invoked during the tick phase in the current facility invocations
purely by practice. There is no requirement for such behavior; for example, one
could send an offer or request during the tock phase, which would be ignored
until the proceeding resolve step. In general lookups for specific markets and
dynamic casts to communicate with those markets are required.</p>
<p>The MarketModel class defines a pure virtual function, <strong>Resolve</strong>, which is
used by derived classes to determine the specific algorithm by which the market
is to be resolved. Markets receive proposed Transactions through their
Communicator class interface, which requires the <strong>ReceieveMessage</strong> function to
be defined by the market. The Resolve function then invokes the derived-class
algorithm to determine matches for the given set of offers and requests.</p>
<p>This class structure and interaction has worked well for a proof-of-prototype
use of Cyclus to model simple, once-through fuel cycles. However, an extension
or refactor is necessary to model more complicated fuel cycles for a number of
reasons. First, there is no support for facilities that can offer or request
resources across multiple commodities if a capacity is included. The current
implementation of the market system can only provide this notion by ordering the
markets in some arbitrary manner. Second, and perhaps least important of these
reasons, is that the Transaction class is ambiguous with respect to proposed
offers, requests, and matched offers and requests. This ambiguity can be
addressed during a refactor to provide clarity to future developers. Third,
there is no defined structure to the market-facility interaction. This
interaction is the core purpose of Cyclus&#8217; Dynamic Resource Exchange concern,
but users and developers are required to define their own interactions (e.g.,
sending offers during the tick phase). The original conception of the tick-tock
paradigm was to define a notion of time before the resource exchange (i.e., a
pre-step) and after the resource exchange (i.e., a post-step). The current
implementation includes the resource exchange concern during both of these
phases, complicating the process and mixing concerns. Finally, there is no
response mechanism for facilities to delineate between resources of a given
commodity. The current implementation places this concern upon the market&#8217;s
resolution algorithm, rather than on the facility via some communication
mechanism, again muddying the concerns associated with the resource exchange.</p>
</div>
<div class="section" id="rationale">
<h2>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<p>The proposed refactor addresses each of the issues provided in the previous
section. The notion of market models is redefined, separating the collection of
supply-demand information from the algorithm used to match suppliers with
consumers. The information gathering framework is structured and core-based. It
is top-down in the sense that it queries facilities for their supply and demand
rather than requiring facility-based notifications. Accordingly, concerns are
appropriately separated: the information is gathered by the core at the
beginning of the resolve step, allowing facilities to inform a given market
algorithm; market algorithms determine the set of offers and requests to be
matched; and the core sends out resolved transactions. Message passing to and
from markets is addressed by the framework, providing facilities, institutions,
and regions each with specific, defined agency.</p>
<div class="section" id="supply-demand-framework">
<h3>Supply-Demand Framework<a class="headerlink" href="#supply-demand-framework" title="Permalink to this headline">¶</a></h3>
<p>Supply-demand determination at any given time step occurs in nominally three
steps, or <strong>phases</strong>, and the associated terminology is taken from previous
supply chain agent-based modeling work
<a class="reference internal" href="#julka-agent-based-2002">[1]</a>. Importantly, this information-gathering step is
agnostic as to the actual matching algorithm used, it is concerned only with
querying the current status of supply and demand and facility preference thereof
in the simulation.</p>
<p>The first phase allows consumers of commodities to denote both the quantity of a
commodity they need to consume as well as the target isotopics, or quality, by
<strong>posting</strong> their demand to the market exchange. This posting informs producers
of commodities what is needed by consumers, and is termed the <strong>Request for
Bids</strong> (RFB) phase. Consumers are allowed to over-post, i.e., request more
quantity than they can actually consume, as long as a corresponding capacity
constraint accompanies this posting. Further, consumers are allowed to post
demand for multiple commodities that may serve to meet the same combine
capacity. For example, consider an LWR that can be filled with MOX or UOX. It
can post a demand for both, but must define a preference over the set of
possible commodities it can consume. Another example is that of an advanced fuel
fabrication facility, i.e., one that fabricates fuel partially from separated
material that has already passed through a reactor. Such a facility can choose
to fill the remaining space in a certain assembly with various types of fertile
material, including depleted uranium from enrichment or reprocessed uranium from
separations. Accordingly, it could demand both commodities as long as it
provides a corresponding constraint with respect to total consumption.</p>
<p>At the completion of the RFB phase, the market exchange will have a set of
consumption portfolios, <img class="math" src="../_images/math/4b4cade9ca8a2c8311fafcf040bc5b15ca507f52.png" alt="P"/>, for each requester in the exchange, shown as
the orange box in Figure 1. Each portfolio consists of a set of requests,
<img class="math" src="../_images/math/eff43e84f8a3bcf7b6965f0a3248bc4d3a9d0cd4.png" alt="R"/>, a cardinal preferential ordering over the requests, <img class="math" src="../_images/math/3ce42873cf3766138e2490e916a5bdc4911a08ba.png" alt="\alpha_R"/>,
and possibly a set of constraints over the requests, <img class="math" src="../_images/math/fcb3a9a1e7b7b5f458af255c5b7e7ec810525422.png" alt="c_R"/>. A constraint
can be associated with more than one request. Take the previous example of MOX
and UOX for an LWR. Each is a separate request, but a constraint may be
concerned with the combination of the two. Another example is a repository that
may request many commodities, but has a radiotoxicity constraint over any
commodities it receives for a given time step.</p>
<p>A request consists of a quantity, <img class="math" src="../_images/math/da9f2cdd3358820c840b33109f88769f39ea7061.png" alt="q_r"/>, and a target isotopic vector,
<img class="math" src="../_images/math/2d7deef62e3de6c78101448f721784bfea9a4400.png" alt="I_r"/>. Consumers are allowed to offer the null set of isotopics as their
profile, effectively providing no information. In general, a requester may have
more than one request (nodes in Figure 1) per commodity. A prime example is a
reactor that chooses to requests fuel assemblies, of which they request many.</p>
<a class="reference internal image-reference" href="../_images/cep-0018-3.png"><img alt="../_images/cep-0018-3.png" class="align-center" src="../_images/cep-0018-3.png" style="width: 238.0px; height: 397.0px;" /></a>
<p><strong>Figure 1:</strong> A Requester during the RFB Phase, where a collection of requests
(as nodes) is shown.</p>
<p>The second phase allows suppliers to <strong>respond</strong> to the set of consumption
portfolios, and is termed the <strong>Response to Request for Bids</strong> (RRFB) phase
(analogous to Julka&#8217;s Reply to Request for Quote phase). Each consumption
portfolio is comprised of requests for some set of commodities, and suppliers of
those commodities are allowed to respond to demand. Suppliers, like consumers,
are allowed to offer the null set of isotopics.</p>
<p>A supplier may have its production constrained by more than one parameter. For
example, a processing facility may have both a throughput constraint (i.e., it
can only process material at a certain rate) and an inventory constraint (i.e.,
it can only hold some total material). Further, the facility could have a
constraint on the quality of material to be processed, e.g., it may be able to
handle a maximum radiotoxicity for any given time step which is a function of
both the quantity of material in processes and the isotopic content of that
material.</p>
<p>At the completion of the RRFB phase, the market exchange will have a set of
supplier responses for each request. The supplier responses define the possible
connections between supplier and producer facilities, i.e., the arcs in a graph
of a matching problem. A response is comprised of a proposed isotopic profile
the supplier is able to provide. Furthermore, constraints can be associated with
the set of responses to be applied by the market matching algorithm. A
constraint must identify the requests that it is associated with, define a
capacity, and define a translation function. The translation function takes a
request as an argument and returns a value in the units of the constraint. A
prime example is an enrichment facility, which may be able to enrich many
orders, but is constrained by the total SWUs it can provide.</p>
<a class="reference internal image-reference" href="../_images/cep-0018-4.png"><img alt="../_images/cep-0018-4.png" class="align-center" src="../_images/cep-0018-4.png" style="width: 228.5px; height: 398.0px;" /></a>
<p><strong>Figure 2:</strong> A Supplier during the RRFB Phase, where a collection of commodity
supplies (as nodes) is shown.</p>
<p>The final phase of the information gathering procedure allows consumer
facilities to adjust their set of preferences and for managers of consumer
facilities to affect the consumer&#8217;s set of preferences, as described in the
remaining sections. Accordingly, the last phase is termed the <strong>Preference
Adjustment</strong> (PA) phase. Preference adjustments can occur in response to the set
of responses provided by producer facilities. Consider the example of a reactor
facility that requests two fuel types, MOX and UOX. It may get two responses to
its request for MOX, each with different isotopic profiles of the MOX that can
be provided. It can then assign preference values over this set of potential MOX
providers. Another prime example is in the case of repositories. A repository
may have a defined preference of material to accept based upon its heat load or
radiotoxicity, both of which are functions of the quality, or isotopics, of a
material. In certain simulators, limits on fuel entering a repository are
imposed based upon the amount of time that has elapsed since the fuel has exited
a reactor, which can be assessed during this phase. The time constraint is, in
actuality, a constraint on heat load or radiotoxicity (one must let enough of
the fission products decay). A repository could analyze possible input fuel
isotopics and set the arc preference of any that violate a given rule to 0,
effectively eliminating that arc.</p>
<p>It should be noted that these preferences are requester based. This choice is
based on the current simulation design notion of requesters having a preference
over possible inputs. It is possible that in the future, one would like to model
the notion of supplier preference (i.e., moreso than the implicit nature
currently provided by allowing suppliers to set the transaction quality and
whether to respond to the transaction at all). One suggestion may be to allow
suppliers to also have a supply preference, and to use the average of them in
the objective function, but this gets into even murkier modeling/simulation
ground. Another would be to move the paradigm more towards economics and have
the suppliers set the cost of a transaction, which they could tailor to the
requester. However, this draws in a whole other field of bidding that requires
much more rigor and thought as to its validity and implementation.</p>
<a class="reference internal image-reference" href="../_images/cep-0018-5.png"><img alt="../_images/cep-0018-5.png" class="align-center" src="../_images/cep-0018-5.png" style="width: 328.5px; height: 271.0px;" /></a>
<p><strong>Figure 3:</strong> A supplier-consumer pair with request isotopics, response
isotopics, and an associated preference.</p>
<p>Institutions and Regions in Cyclus are provided in order to add granularity to
the levels of relational modeling available to a user or developer. Both types
of agents or models in Cyclus can possibly be allowed to affect preferences
during the PA phase. A slightly longer discussion is included below.</p>
<div class="section" id="facility-agency">
<h4>Facility Agency<a class="headerlink" href="#facility-agency" title="Permalink to this headline">¶</a></h4>
<p>Facilities in Cyclus are abstracted to either consumers or suppliers of
commodities, and some may be both. Supplier agents are provided agency by being
able to communicate to the market-resolution mechanism a variety of production
capacity constraints in second phase of the information gathering
methodology. Consumer agents are provided agency by being able to assign
preferences among possible suppliers based on the supplier&#8217;s quality of
product. Because this agency is encapsulated for each agent, it is possible to
define strategies that can be attached or detached to the agents at
run-time. Such strategies are an example of the Strategy design pattern
<a class="reference internal" href="#vlissides-design-1995">[2]</a>.</p>
</div>
<div class="section" id="institutional-agency">
<h4>Institutional Agency<a class="headerlink" href="#institutional-agency" title="Permalink to this headline">¶</a></h4>
<p>Institutions in Cyclus manage a set of facilities. Facility management is
nominally split into two main categories: the commissioning and decommissioning
of facilities and supply-demand association. The goal of including a notion of
institutions is to allow an increased level of detail when investigating
regional-specific scenarios. For example, there exist multi-national
enterprises, such as AREVA, that operate fuel cycle facilities in a variety of
countries, or regions. Furthermore, there are international governmental
organizations, such as the IAEA, have proposed managing large fuel cycle
facilities that service many countries in a given global region. A fuel bank is
an example of such a facility.</p>
<p>Accordingly, institutions in this proposal are able to augment the preferences
of supplier-consumer pairs that have been established in order to simulate a
mutual preference to trade material within an institution. Of course, situations
arise in real life where an institution has the capability to service its own
facilities, but choose to use an outside provider because of either cost or time
constraints. Such a situation is allowed in this framework as well. It is not
clear how such a relationship should be instantiated and to what degree
institutions should be allowed to affect their managed facilities&#8217;
preferences. This issue lies squarely in the realm of simulation design
decisions, part of the <strong>art</strong> of simulation. Accordingly, the strategy of
affecting preferences is encapsulated within the full preference allocation
phase in order to allow for further modularity of relational options between
agents.</p>
</div>
<div class="section" id="regional-agency">
<h4>Regional Agency<a class="headerlink" href="#regional-agency" title="Permalink to this headline">¶</a></h4>
<p>Regions are provided agency by their ability to affect preferences between
supplier-consumer facility pairs in the PA phase, much like institutions. The
ability to perturb arc preferences between a given supplier and a given consumer
allows fuel cycle simulation developers to model relatively complex interactions
at a regional level, such as tariffs and sanctions. Constraints to cross-border
trading can also be applied. For example, a region could place constraints on
the total amount of a given commodity type that is able to flow into it or out
of it into a different region. Such constraints could applied not only to bulk
quantities of a commodity, but also to the quality of each commodity. Such a
mechanism could be used to model interdiction of highly-enriched uranium
transport, for example.</p>
<div align="center" class="align-center"><img src="../_images/cep-0018-2.svg" /></div>
<p><strong>Figure 4:</strong> Information Gathering Phase Order.</p>
</div>
</div>
<div class="section" id="market-resolution">
<h3>Market Resolution<a class="headerlink" href="#market-resolution" title="Permalink to this headline">¶</a></h3>
<p>Upon completion of the information gathering step, the market resolution
function will be called. The current &#8220;null market&#8221; behavior is defined as a
&#8220;greedy matching&#8221; algorithm. Such an algorithm as currently implemented naively
matches consumers with suppliers without particular regard for preference of
commodity or resource. Accordingly, a similar algorithm will be implemented that
greedily matches supplier and requester based on the requester&#8217;s highest
preference, accounting for multiple commodity markets and associated production
capacities. The matching algorithm used by a market is modular, and replaces the
notion of the MarketModel.</p>
</div>
</div>
<div class="section" id="specification-implementation">
<h2>Specification &amp; Implementation<a class="headerlink" href="#specification-implementation" title="Permalink to this headline">¶</a></h2>
<p>Each major phase method and associated classes are treated. Method inputs and
outputs are described as well as known issues dealing with their
implementation. The members and methods of proposed classes are also
described. Because the phases utilize new classes and containers, those are
described first.</p>
<div class="section" id="constituent-classes-and-containers">
<h3>Constituent Classes and Containers<a class="headerlink" href="#constituent-classes-and-containers" title="Permalink to this headline">¶</a></h3>
<p>The major new datastructures required for this proposal are:</p>
<ul class="simple">
<li>Bids</li>
<li>BidPortfolios</li>
<li>CapacityConstraints</li>
<li>Requests</li>
<li>RequestPortfolios</li>
</ul>
<p>Reference implementation (in /src) and tests (in /tests) for each can be found
in the <a class="reference external" href="https://github.com/gidden/cyclus/tree/cep18">CEP18 branch</a>.</p>
<p>A template approach has been taken, delineating, for instance, a material
request, <tt class="docutils literal"><span class="pre">Request&lt;Material&gt;</span></tt>, from a GenericResource request,
<tt class="docutils literal"><span class="pre">Request&lt;GenericResource&gt;</span></tt>. The current behavior (i.e., only using parent
classes and dynamic casting to derived classes) can be invoked by templating on
the <tt class="docutils literal"><span class="pre">Resource</span></tt> type, i.e., <tt class="docutils literal"><span class="pre">Request&lt;Resource&gt;</span></tt>. See the <a class="reference external" href="https://github.com/gidden/cyclus/blob/cep18/tests/capacity_constraint_tests.cc">capacity constraint
tests</a> for an example of this range of behavior.</p>
</div>
<div class="section" id="resource-exchange">
<h3>Resource Exchange<a class="headerlink" href="#resource-exchange" title="Permalink to this headline">¶</a></h3>
<p>The resource exchange is implemented through coordination of two classes, the
ResourceExchange and the ExchangeContext, both of which are implemented with
tests in the <a class="reference external" href="https://github.com/gidden/cyclus/tree/cep18">CEP18 branch</a>.</p>
<p>The ExchangeContext retains the current state of the exchange, including
information regarding the players (i.e., requesters and suppliers) as well as
information regarding requests and bids. The ResourceExchange initiates the
phase order and updates the context state. As currently envisioned, an exchange
and context&#8217;s lifetime is the single resolution of the exchange at a given
time. The exchange is populated with traders as known by the wider simulation
context. Both the ExchangeContext and ResourceExchange are templated on the
Resource being exchanged, as was the case above. An overview of the exchange
implementation follows, noting the state updates of the context at each phase.</p>
<div class="section" id="rfb-phase">
<h4>RFB Phase<a class="headerlink" href="#rfb-phase" title="Permalink to this headline">¶</a></h4>
<p>Note that the ExchangeContext has no state at the beginning of the phases.</p>
<p>ResourceExchange operations:</p>
<ul class="simple">
<li>Queries each Trader registered with the simulation Context, asking for
RequestPortfolios</li>
</ul>
<p>ExchangeContext state at end of phase:</p>
<ul class="simple">
<li>Requesters</li>
<li>Requests</li>
<li>RequestPortfolio</li>
</ul>
</div>
<div class="section" id="rrfb-phase">
<h4>RRFB Phase<a class="headerlink" href="#rrfb-phase" title="Permalink to this headline">¶</a></h4>
<p>ResourceExchange operations:</p>
<ul class="simple">
<li>Queries each Trader registered with the simulation Context, asking for
BidPorftolios</li>
<li>The ExchangeContext is given to each trader in order to determine all Requests
for a specific commodity</li>
</ul>
<p>ExchangeContext state at end of phase:</p>
<ul class="simple">
<li>Bidders</li>
<li>BidPortfolios</li>
<li>Default preferences for each Bid-Request pair (provided in the original Request)</li>
</ul>
</div>
<div class="section" id="pa-procedure">
<h4>PA Procedure<a class="headerlink" href="#pa-procedure" title="Permalink to this headline">¶</a></h4>
<p>ResourceExchange operations:</p>
<ul class="simple">
<li>For each Requester and each parent in the Model child-parent tree of that
Requester, preferences are allowed to be perturbed, which looks nominally like:</li>
</ul>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">/// @brief allows a trader and its parents to adjust any preferences in the</span>
<span class="c1">/// system</span>
<span class="kt">void</span> <span class="nf">DoAdjustment</span><span class="p">(</span><span class="n">Trader</span><span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">typename</span> <span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&amp;</span> <span class="n">prefs</span> <span class="o">=</span> <span class="n">ex_ctx_</span><span class="p">.</span><span class="n">Prefs</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
  <span class="n">Model</span><span class="o">*</span> <span class="n">m</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Model</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">AdjustPrefs</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">prefs</span><span class="p">);</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>For full implementation details, please see the <a class="reference external" href="https://github.com/gidden/cyclus/tree/cep18">CEP18 branch</a>.</p>
<p>ExchangeContext state at end of phase:</p>
<ul class="simple">
<li>Possibly perturbed preferences for each Bid-Request pair</li>
</ul>
</div>
<div class="section" id="marketalgorithm">
<h4>MarketAlgorithm<a class="headerlink" href="#marketalgorithm" title="Permalink to this headline">¶</a></h4>
<p>The MarketAlgorithm is a virtual base class for possible algorithms to solve the
supply-demand matching algorithm.</p>
<p>The input for the algorithm is the full set of Requests, Bids, preferences, and
CapacityConstraints.</p>
<p>The output for the algorithm is Request-Bid pairs such that CapacityConstraints
are not exceeded.</p>
</div>
</div>
</div>
<div class="section" id="backwards-compatibility">
<h2>Backwards Compatibility<a class="headerlink" href="#backwards-compatibility" title="Permalink to this headline">¶</a></h2>
<p>This CEP proposes a number of backwards incompatibilities.</p>
<ul class="simple">
<li>The MarketModel is replaced by an information gathering procedure and a
modular MarketAlgorithm</li>
<li>Transactions are reduced to accepted offers, rather than proposed offers and
requests</li>
<li>The Message and Communicator classes are no longer needed</li>
</ul>
</div>
<div class="section" id="document-history">
<h2>Document History<a class="headerlink" href="#document-history" title="Permalink to this headline">¶</a></h2>
<p>This document is released under the CC-BY 3.0 license.</p>
</div>
<div class="section" id="references-and-footnotes">
<h2>References and Footnotes<a class="headerlink" href="#references-and-footnotes" title="Permalink to this headline">¶</a></h2>
<p class="rubric">References</p>
<p id="bibtex-bibliography-cep/cep18-0"><table class="docutils citation" frame="void" id="julka-agent-based-2002" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>)</em> N.&nbsp;Julka, R.&nbsp;Srinivasan, and I.&nbsp;Karimi. Agent-based supply chain management-1: framework. <em>Computers &amp; Chemical Engineering</em>, 26(12):1755–1769, 2002.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="vlissides-design-1995" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>John Vlissides, R&nbsp;Helm, R&nbsp;Johnson, and E&nbsp;Gamma. Design patterns: elements of reusable object-oriented software. <em>Reading: Addison-Wesley</em>, 1995.</td></tr>
</tbody>
</table>
</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="cep17.html" title="CEP 17 - Resource Tracking and Interfaces Re-Re-Redo"
             >previous</a> |</li>
        <li><a href="../index.html">Cyclus Home</a> &raquo;</li>
          <li><a href="cep0.html" >Cyclus Enhancement Proposals</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, University of Wisconsin Computational Nuclear Engineering Research Group.
      Last updated on Oct 31, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>